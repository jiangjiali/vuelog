title: TOTP机密引擎
------------------------------------
<!-- zh-CN:+ -->
TOTP机密引擎根据TOTP标准生成基于时间的凭证。机密引擎还可以用来生成一个新的密钥，并验证由该密钥生成的密码。

TOTP机密引擎既可以充当生成器（如Google Authenticator）也可以充当提供者。

作为生成器
----------------------------------

TOTP机密引擎可以充当TOTP代码生成器。在这种模式下，它可以取代传统的TOTP生成器，比如Google Authenticator。它提供了额外的安全层，因为生成代码的能力受到策略的保护，并且整个过程都经过审核。

### 安装

大多数秘密引擎必须事先配置好才能执行其功能。这些步骤通常由操作员或配置管理工具完成。

1.  启用TOTP机密引擎：
    
    ```
    $ vault secrets enable totp
    Success! Enabled the totp secrets engine at: totp/
    
    ```
    
    默认情况下，机密引擎将安装在引擎的名称处。要在其他路径上启用机密引擎，请使用“-path”参数。
    
2.  配置命名密钥。此密钥的名称将作为其用途的人工标识符。
    
    ```
    $ vault write totp/keys/my-key \
        url="otpauth://totp/Vault:test@test.com?secret=Y64VEVMBTSXCYIWRSHRNDZW62MPGVU2G&issuer=Vault"
    Success! Data written to: totp/keys/my-key
    
    ```
    
    “url”对应于第三方服务提供的条形码中的密钥或值。
    

### 使用

在配置机密引擎并且用户/计算机具有具有适当权限的安全库令牌之后，它可以生成凭据。

1.  通过从具有密钥名称的“/code”终结点读取，生成新的基于时间的OTP：
    
    ```
    $ vault read totp/code/my-key
    Key     Value
    ---     -----
    code    260610
    
    ```
    
    使用ACL，可以限制使用TOTP机密引擎，以便受信任的操作员可以管理密钥定义，并且用户和应用程序都受到允许读取的凭据的限制。
    

作为提供者
--------------------------------

TOTP机密引擎也可以充当TOTP提供者。在这种模式下，它可以用来生成新的密钥，并验证使用这些密钥生成的密码。

### 安装

大多数秘密引擎必须事先配置好才能执行其功能。这些步骤通常由操作员或配置管理工具完成。

1.  启用TOTP机密引擎：
    
    ```
    $ vault secrets enable totp
    Success! Enabled the totp secrets engine at: totp/
    
    ```
    
    默认情况下，机密引擎将安装在引擎的名称处。要在其他路径上启用机密引擎，请使用“-path”参数。
    
2.  使用“generate”选项创建命名键。这将告诉安全库作为提供程序：
    
    ```
    $ vault write totp/keys/my-user \
        generate=true \
        issuer=Vault \
        account_name=user@test.com
    
    Key        Value
    ---        -----
    barcode    iVBORw0KGgoAAAANSUhEUgAAAMgAAADIEAAAAADYoy0BA...
    url        otpauth://totp/Vault:user@test.com?algorithm=SHA1&digits=6&issuer=Vault&period=30&secret=V7MBSK324I7KF6KVW34NDFH2GYHIF6JY
    
    ```
    
    响应包括base64编码的条形码和OTP url，两者相当。将这些给正在使用TOTP进行身份验证的用户。
    

### 使用

1.  作为用户，验证第三方应用程序生成的TOTP代码：
    
    ```
    $ vault write totp/code/my-user code=886531
    Key      Value
    ---      -----
    valid    true
    
    ```

<!-- zh-CN:- -->

<!-- en-US:+ -->
The TOTP confidential engine generates time-based credentials according to the TOTP standard. The secret engine can also be used to generate a new key and verify the password generated by the key.

The TOTP secret engine can act as both a generator (such as Google Authenticator) and a provider.

As a generator
----------------------------------

The TOTP secret engine can act as a TOTP code generator. In this mode, it can replace traditional TOTP generators, such as Google Authenticator. It provides an extra layer of security because the ability to generate code is protected by policy and the entire process is audited.

### Installation

Most secret engines must be configured in advance to perform their functions. These steps are usually completed by operators or configuration management tools.

1. Enable TOTP secret engine:
    
    ```
    $ vault secrets enable totp
    Success! Enabled the totp secrets engine at: totp/
    
    ```
    
    By default, the confidential engine will be installed at the name of the engine. To enable the secret engine on other paths, use the "-path" parameter.
    
2. Configure the named key. The name of this key will serve as an artificial identifier for its purpose.
    
    ```
    $ vault write totp/keys/my-key \
        url="otpauth://totp/Vault:test@test.com?secret=Y64VEVMBTSXCYIWRSHRNDZW62MPGVU2G&issuer=Vault"
    Success! Data written to: totp/keys/my-key
    
    ```
    
    "Url" corresponds to the key or value in the barcode provided by the third-party service.
    

### Use

After the secret engine is configured and the user/computer has a security library token with appropriate permissions, it can generate credentials.

1. Generate a new time-based OTP by reading from the "/code" endpoint with the key name:
    
    ```
    $ vault read totp/code/my-key
    Key Value
    --- -----
    code 260610
    
    ```
    
    Using ACLs, you can restrict the use of the TOTP secret engine so that trusted operators can manage key definitions, and users and applications are restricted by credentials that are allowed to be read.
    

As a provider
--------------------------------

The TOTP confidential engine can also act as a TOTP provider. In this mode, it can be used to generate new keys and verify the passwords generated using these keys.

### Installation

Most secret engines must be configured in advance to perform their functions. These steps are usually completed by operators or configuration management tools.

1. Enable TOTP secret engine:
    
    ```
    $ vault secrets enable totp
    Success! Enabled the totp secrets engine at: totp/
    
    ```
    
    By default, the confidential engine will be installed at the name of the engine. To enable the secret engine on other paths, use the "-path" parameter.
    
2. Use the "generate" option to create a named key. This will tell the security library to act as a provider:
    
    ```
    $ vault write totp/keys/my-user \
        generate=true \
        issuer=Vault \
        account_name=user@test.com
    
    Key Value
    --- -----
    barcode iVBORw0KGgoAAAANSUhEUgAAAMgAAADIEAAAAADYoy0BA...
    url otpauth://totp/Vault:user@test.com?algorithm=SHA1&digits=6&issuer=Vault&period=30&secret=V7MBSK324I7KF6KVW34NDFH2GYHIF6JY
    
    ```
    
    The response includes a base64-encoded barcode and OTP url, which are equivalent. Give these to users who are using TOTP for authentication.
    

### Use

1. As a user, verify the TOTP code generated by a third-party application:
    
    ```
    $ vault write totp/code/my-user code=886531
    Key Value
    --- -----
    valid true
    
    ```
<!-- en-US:- -->